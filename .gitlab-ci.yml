image: node:latest

stages:
  - build-abstract-scanner
  - cardano-scanner-installation
  - cardano-scannner-test
  - bridge-scanner-installation
  - bridge-scanner-test

cache:
  paths:
    - cardano-scanner/node_modules/
    - bridge-scanner/node_modules/
    - abstract-scanner/dist

abstract_scanner:
  stage: build-abstract-scanner
  script:
    - cd ./abstract-scanner
    - npm install
    - npm run build

install_cardano_scanner_dependencies:
  stage: cardano-scanner-installation
  script:
    - cd ./cardano-scanner
    - npm install
  artifacts:
    paths:
      - node_modules/
cardano_scannner_test:
  stage: cardano-scannner-test
  script:
    - cd ./cardano-scanner
    - npm run coverage
  artifacts:
    reports:
      cobertura: coverage/cobertura-coverage.xml
install_bridge_scanner_dependencies:
  stage: bridge-scanner-installation
  script:
    - cd ./bridge-scanner
    - npm install
  artifacts:
    paths:
      - node_modules/
bridge_scanner_test:
  stage: bridge-scanner-test
  script:
    - cd ./bridge-scanner
    - npm run coverage
  artifacts:
    reports:
      cobertura: coverage/cobertura-coverage.xml
